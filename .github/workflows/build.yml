name: Build V2Ray rules dat files
on: [push]
  # schedule:
  #   - cron: "0 0 */1 * *"

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    strategy:
      matrix:
        rule: [geoip, geosite]
        include:
          - rule: geoip
            artifact_name: geoip.dat
            asset_name: geoip.dat
          - rule: geosite
            artifact_name: geosite.dat
            asset_name: geosite.dat

    steps:
      - name: Set up Go 1.13
        uses: actions/setup-go@v1
        with:
          go-version: 1.13
        id: go

      - name: Check out code into the Go module directory
        uses: actions/checkout@v1

      - name: Generate geoip.dat and geosite.dat file
        run: |
          chmod +x generate-rules-dat.sh
          ./generate-rules-dat.sh

      - name: Upload dat files to release
        uses: svenstaro/upload-release-action@v1-release
        with:
          file: /home/runner/work/v2ray-rules-dat/v2ray-rules-dat/v2ray/${{ matrix.artifact_name }}
          asset_name: ${{ matrix.asset_name }}
          tag: latest
          overwrite: true
          repo_token: ${{ secrets.GITHUB_TOKEN }}
